AppFW 要件書
===

本ドキュメントではADX AppFWの要素（機能）とそれに属する要件を記述する。  
記述方法は、[AppFW要求管理フェーズ 説明書](http://auto-drive-git.cp.toyota.co.jp/ADX/adx_process/blob/master/ApplicationUnitLayer/document/SWRequirementManagement_Phase_manual.md)を参照。


識別子（ID）の付け方
---

親要件(要求)/要素/要件の識別子（ID）は、【プリフィックス4文字-APPFW要求管理JIRAチケット番号4桁-枝番号3桁-安全要求を示すサフィックス】で表す。

- IDの内訳
  - プリフィックス4文字  
    親要件にはSYRQ（System Requirements）、要素/要件にはSWRQ（Software Requirements）を付ける。

  - APPFW要求管理のJIRAチケット番号4桁  
    プリフィックスAPPFWに要求管理JIRAチケットの番号4桁を付けたもの。  

    **要素や要件に紐付く要求管理JIRAチケットが存在しない場合の暫定対応**  
    要素や要件は既に存在しているものの、要求管理JIRAチケットが未発行の場合は、チケット番号4桁をX000、X001、・・・、X999の範囲で仮置きする。（未発行のJIRAチケットを後で検索しやすくするため）

  - 枝番号3桁  
    採番ルールは特になし。作業者が自由に決める。

  - 安全要求を示すサフィックス  
    安全要求を含む親要件である場合は「S」を付与する。

- 記載例
  - 要求管理JIRAチケット番号が「1234」の親要件ID：SYRQ-APPFW1234-800
  - 要求管理JIRAチケット番号が「1234」で、安全要求を含む親要件の要件ID：SWRQ-APPFW1234-011-S

- 注意点
  - 親要件ID/要素ID/要件IDには一意のIDを付けること。特に、「要求管理JIRAチケット番号4桁」が同じ場合は、IDが重複しないように枝番号を決めること。
  - 複数の要素に対して全く同じ要件が割り当てられた場合でも、要件IDは要素ごとに分けること。


運用上のルール
---

- 要求管理JIRAチケットの要求項目にも親要件IDを記述する

- 要件を変更した場合は、古い要件IDを変更履歴欄に追加する


**要件変更時の注意**  
ID自体は親要件/要素/要件のつながりを示しているものではない。従って、要件変更の影響範囲を検討する際は、IDの類似性を無視すること。
例えば、要件Xに紐付く親要件が複数あり、それを親要件A、親要件Bとする。要件Xと親要件AのIDは「要求管理JIRAチケット番号4桁」が同じとする。
新たな親要件Cによって要件Xを変更する場合、IDが類似している親要件Aだけでなく、親要件Bへの影響も忘れず検討すること。

AppFW
---

| 要素ID              | 要素名 | 要素概要                                                               | 親要素             | 親要件              | 変更履歴 |
| ------------------  | -------- | ---------------------------------------------------------------------- | ------------------ | ------------------  | ---  |
| SWRQ-APPFW2529-100 | AppFW    | モジュール群の実行管理・データ通信のための機構を提供するフレームワーク |                    | SYRQ-APPFW2529-000 |      |


| 要件ID              | 要件内容                                                                          | 親要件              | 変更履歴 |
| ---                 | ---                                                                               | ----                | ---  |
| PV:IFCOND(pv:hasFeature('Temperature')) ||||
| SWRQ-APPFW2529-101 | プロセス起動からモジュールがReady状態になるまでxxx sec                            | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-102 | モジュールを除くAppFWでのメモリ使用量はxxx MiB                                    | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-103 | モジュールのCompute処理を除くCPU使用率 xxx% 以下であること                        | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-104 | モジュール以外のスレッドの動作するCPUコアを指定可能であること                     | SYRQ-APPFW2529-000 |      |
|PV:ENDCOND ||||
|PV:IFCOND(pv:hasFeature('WindSpeed')) ||||
| SWRQ-APPFW2529-105 | ポインタ演算および非同期なメモリ管理の採用は最小限とすること                      | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-106 | 標準CライブラリおよびPOSIX API、内製Platform Service Layer(PSL)へのみ依存すること | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-107 | データ・モジュール等の各定義はJSON(HJSON)を採用すること                           | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-108 | POSIX OS要件定義書に従うこと                                                      | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2420-001 | 100以下のモジュールを同時に起動できること。                                       | SYRQ-APPFW2420-000 |      |
|PV:ENDCOND ||||

データ定義機能
---

| 要素ID              | 要素名         | 要素概要                                                                     | 親要素              | 親要件              | 変更履歴 |
| ---                 | ---            | ---                                                                          | ---                 | ---                 | ---      |
| SWRQ-APPFW2529-200 | データ定義機能 | モジュール間で授受されるデータの型を定義し動作可能なプログラムを自動生成する | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000 |          |


| 要件ID              | 要件内容                                                                                | 親要件              | 変更履歴 |
| ---                 | ---                                                                                     | ---                 | ---  |
| SWRQ-APPFW2529-201 | 列挙型 が定義できること                                                                 | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-202 | 基本型および定義済み構造体、列挙型を含む構造体が定義できること                          | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-203 | 構造体は基本型または定義済み構造体の配列を含むことができること                          | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-204 | データ定義毎にアプリ内でのみ参照可能またはアプリを跨ぎ参照可能のいずれかを指定できる    | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-220 | データ定義を基にC/C++から呼び出し可能な構造体・enumのプログラムコードを自動生成すること | SYRQ-APPFW2529-000 |      |



定数定義機能
---

| 要素ID | 要素名 | 要素概要 | 親要素 | 親要件 | 変更履歴 |
| --- | --- | --- | --- | --- | --- |
| SWRQ-APPFW2529-700 | 定数定義機能 | 定数を定義しプログラムを自動生成する | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000 ||

| 要件ID | 要件内容 | 親要件 | 変更履歴 |
| --- | --- | --- | --- |
| SWRQ-APPFW2529-701 | 基本型による定数定義ができること | SYRQ-APPFW2529-000 ||
| SWRQ-APPFW2529-702 | 定数定義を基にC/C++から参照可能なプログラムコードを自動生成すること | SYRQ-APPFW2529-000 ||


モジュール定義機能
---

| 要素ID              | 要素名             | 要素概要                                             | 親要素              | 親要件              | 変更履歴 |
| ---                 | ---                | ---                                                  | ---                 | ---                 | ---      |
| SWRQ-APPFW2529-300 | モジュール定義機能 | モジュールを定義し動作可能なプログラムを自動生成する | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000 |          |


| 要件ID              | 要件内容                                                                                    | 親要件              | 変更履歴 |
| ---                 | ---                                                                                         | ---                 | ---  |
| SWRQ-APPFW2529-301 | モジュールの入力データが定義できること                                                      | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-302 | モジュールの出力データが定義できること                                                      | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-303 | モジュールの起動条件として特定の入力データの更新またはタイマーを指定できること              | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-304 | 1ないし複数のモジュールの集合であるアプリが定義できること                                   | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-305 | 各入出力データに対してCPU/GPU/アクセラレータ等のメモリを用いるよう指定可能であること        | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-306 | モジュールが起動時に読み込み可能なパラメータを定義できること | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-307 | モジュールの起動条件としてトリガーデータで接続された後段モジュール(トリガーデータによる閉ループ状態)の出力データを指定できること | SYRQ-APPFW2529-000 ||
| SWRQ-APPFW2529-320 | モジュール定義を基にC/C++から呼び出し可能なスレッド/プロセスを制御するプログラムコードを自動生成すること | SYRQ-APPFW2529-000 |      |


起動構成定義機能
---

| 要素ID              | 要素名           | 要素概要                                                     | 親要素              | 親要件              | 変更履歴 |
| ---                 | ---              | ---                                                          | ---                 | ---                 | ---      |
| SWRQ-APPFW2529-400 | 起動構成定義機能 | プロセスの起動構成を定義し動作可能なプログラムを自動生成する | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000 |          |


| 要件ID              | 要件内容                                                                                  | 親要件              | 変更履歴 |
| ---                 | ---                                                                                       | ----                | ---  |
| SWRQ-APPFW2529-401 | 定義済みのモジュールのうち起動するものを定義できること                                    | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-402 | 起動するモジュールのCPUコアアフィニティを定義できること                                   | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-403 | 起動するモジュールのスレッド優先度を定義できること                                        | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-404 | モジュールのパラメータに設定すべき値を定義できること                                        | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-420 | 起動構成定義を基にC/C++から呼び出し可能な初期化処理を含むプログラムコードを自動生成すること | SYRQ-APPFW2529-000 |      |


通信機能
---

| 要素ID              | 要素名   | 要素概要                                                                                                                                      | 親要素              | 親要件              | 変更履歴 |
| ---                 | ---      | ---                                                                                                                                           | ---                 | ---                 | ---      |
| SWRQ-APPFW2529-500 | 通信機能 | モジュール定義およびデータ定義から自動生成されたプログラムコードおよびスレッド/プロセス間の通信機能によりモジュール間のデータ送受信を実現する | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000 |          |


| 要件ID              | 要件内容                                                                                                                                            | 親要件              | 変更履歴 |
| ---                 | ---                                                                                                                                                 | ---                 | ---  |
| SWRQ-APPFW2529-508 | データ定義機能で定義されたデータがモジュール定義機能で定義されたモジュール間で送受信できること                                            | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-509 | モジュールがデータの送信可否を決定できること | SYRQ-APPFW2529-000 ||
| SWRQ-APPFW2529-501 | mq を始めとするOS APIの使用を必要最低限とする。特にmqおよびslogger2については使用しないことを原則とする                                             | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-502 | モジュール及びAppFW間でのメッセージ送受信において、1つのモジュールが複数メッセージを送信する場合にメッセージをまとめ、OS API呼び出しを1度にすること | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-503 | モジュールの出力から次の入力による駆動までが xxx us以下であること                                                                                   | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-504 | モジュールの出力が受信モジュールで参照可能になるまで xxx us以下であること                                                                           | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-505 | 通信に使用するメモリのページ割当を起動時に行うこと                                                                                                  | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-506 | 通信に使用するメモリ量が定義および設定から静的に導出可能であること                                                                                  | SYRQ-APPFW2529-000 |      |
| SWRQ-APPFW2529-507 | モジュール間データ授受は専用のメモリ領域を介して行う。受信側の参照を維持するため、送信側の処理ループとは異なるライフサイクルのメモリ領域とする      | SYRQ-APPFW2529-000 |      |


機能安全設計
---

| 要素ID               | 要素名                   | 要素概要                                                                                       | 親要素              | 親要件                                                | 変更履歴 |
| ---                  | ---                      | ---                                                                                            | ---                 | ---                                                   | ---      |
| SWRQ-APPFW2529-600S | システマティック異常検出 | 各コンポーネントの異常をAssistantModule へ通知する                                             | SWRQ-APPFW2529-100 | ADX-SCSR-0001                                         |          |
| SWRQ-APPFW2529-610S | デッドライン監視         | 各コンポーネントの処理時間が規定時間を超えた場合にAssistantModule へ通知する                   | SWRQ-APPFW2529-100 | ADX-SCSR-00[1-7]0,ADX-SCSR-00[1-7]1,ADX-SCSR-00[1-7]2 |          |
| SWRQ-APPFW2529-620S | データレンジチェック     | 各コンポーネントの入力データが許容値内かチェックを行い逸脱した場合にAssistantModule へ通知する | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000                                   |          |
| SWRQ-APPFW2529-630S | 制御フロー監視           | 各コンポーネントの呼び出し順が設計通りかチェックし逸脱した場合にAssistantModule へ通知する     | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000                                   |          |
| SWRQ-APPFW2529-640S | メモリパーティショニング | ASILの異なる機能を異なるプロセスへ配置する                                                     | SWRQ-APPFW2529-100 | SYRQ-APPFW2529-000                                   |          |


| 要件ID              | 要件内容                                                                                      | 親要件             | 変更履歴 |
| ---                 | ---                                                                                           | ---                | ---  |
| SWRQ-APPFW2529-601S | 各モジュールの異常をAppFWが検出できること                                                     | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-602S | 異常をAssistantModuleへ伝達できること                                                         | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-611S | 各モジュールの処理実行開始時に実行時間監視カウンタを0リセットできること                       | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-612S | 各モジュールの処理実行終了時に実行時間監視カウンタ値が100ms以内であれば実行時間監視カウンタを停止 | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-613S | 実行時間監視カウンタ値が100msを経過した場合実行時間監視カウンタを停止し、異常をAssistantModuleへ伝達できること            | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-621S | モジュールからの送信データの上下限を定義できること                                            | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-622S | 定義に基づきモジュールからの送信データの上下限をチェックできること                          | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-631S | (SWAと議論中)                                                                                 | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-641S | プロセスをまたがりモジュールの通信ができること                                                | SYRQ-APPFW2094-100 |      |
| SWRQ-APPFW2529-642S | 通信毎に分離されたメモリ領域を確保し相互にメモリ破壊を防げること                              | SYRQ-APPFW2094-100 |      |


エラー検知・通知機能
---

| 要素ID             | 要素名               | 要素概要                                        | 要求ID             | 変更履歴           |
| ------------------ | -------------------- | ----------------------------------------------- | ------------------ | ------------------ |
| SWRQ-APPFW2094-000 | エラー検知・通知機能 | エラーを検知し、ADXのIOモジュールに通知する機能 | SYRQ-APPFW2094-100 |                    |

| 要件ID             | 要件内容                                                      | 親要件          | 変更履歴           |
| ------------------ | ------------------------------------------------------------- | ---------------- | ------------------ |
| SWRQ-APPFW2094-001 | AppFW管理のコンテキスト（※）で発生し得る全てのエラーを検知できること。 <br> ECUに載らないコードは対象外とする。 <br> ログ出力関数が失敗した場合については、エラー検知の必要はない。 <br> ※AppFWのスレッド、および、モジュールスレッド内のAppFW管理コード | SYRQ-APPFW2094-100 |   |
| SWRQ-APPFW2094-002 | ADXのIOモジュールがエラーを受け取れるエラー通知方法であること | SYRQ-APPFW2094-100 |   |
| SWRQ-APPFW2094-003 | エラーの重要度は次のいずれかに分類可能なこと。 <br> - ADXは制御継続可能 <br> - ADXは制御継続不可、かつ、ADXの再起動で復帰可能 <br> - ADXは制御継続不可、かつ、ADXの再起動で復帰不可 | SYRQ-APPFW2094-200 |   |
| SWRQ-APPFW2094-004 | 1スレッドで複数のエラーを検知した場合は、重要度の最も高いエラー1つを通知すること | SYRQ-APPFW2094-200 |   |
| SWRQ-APPFW2094-005 | エラー発生前に確保した排他オブジェクト（セマフォ等）はエラー処理にて解放すること | SYRQ-APPFW2094-300 |   |
